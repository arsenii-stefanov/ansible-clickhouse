---

# ClickHouse Binary path to check if ClickHouse is installed on the host machine
clickhouse_binary_path: "/usr/bin/clickhouse-server"
docker_binary_path: "/usr/bin/docker"
clickhouse_systemd_service_name: "clickhouse-server"
clickhouse_systemd_service_template: "systemd/{{ clickhouse_systemd_service_name }}.service.j2"
clickhouse_repo: "deb http://repo.yandex.ru/clickhouse/deb/stable/ main/"
#clickhouse_repo_old: "deb http://repo.yandex.ru/clickhouse/bionic stable main"
clickhouse_repo_keyserver: keyserver.ubuntu.com
clickhouse_repo_key: E0C56BD4
clickhouse_package:
  - "clickhouse-client={{ clickhouse_version }}"
  - "clickhouse-common-static={{ clickhouse_version }}"
  - "clickhouse-server={{ clickhouse_version }}"

clickhouse_group_host:
  name: "clickhouse"
#  gid: 116

clickhouse_owner_host:
  name: "clickhouse"
#  uid: 112
  comment: "ClickHouse server"
  group: "{{ clickhouse_group_host['name'] }}"
  home: "/nonexistent"
  shell: "/bin/false"

clickhouse_default_main_dir: "/var/lib/clickhouse"
clickhouse_default_main_server_config_dir: "/etc/clickhouse-server"
clickhouse_default_main_client_config_dir: "/etc/clickhouse-client"
clickhouse_default_include_config_dir: "{{ clickhouse_default_main_server_config_dir }}/conf.d"
clickhouse_default_log_dir: "/var/log/clickhouse-server"

clickhouse_directories_host:
### CONFIG DIR
  - host_dir: "{{ clickhouse_main_server_config_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
  - host_dir: "{{ clickhouse_include_server_config_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
  - host_dir: "{{ clickhouse_ssl_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
  - host_dir: "{{ clickhouse_main_client_config_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
  - host_dir: "{{ clickhouse_include_client_config_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
#### DATA DIR
  - host_dir: "{{ clickhouse_main_data_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
### LOG DIR
  - host_dir: "{{ clickhouse_log_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
### DATA SUBDIRS
  - host_dir: "{{ clickhouse_data_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
  - host_dir: "{{ clickhouse_shadow_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
  - host_dir: "{{ clickhouse_access_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
  - host_dir: "{{ clickhouse_prep_conf_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
  - host_dir: "{{ clickhouse_store_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
  - host_dir: "{{ clickhouse_metadata_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
  - host_dir: "{{ clickhouse_tmp_dir }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0750"
  # - host_dir: "{{ clickhouse_ssl_dir }}"
  #   owner: "{{ clickhouse_owner_host['name'] }}"
  #   group: "{{ clickhouse_group_host['name'] }}"
  #   mode: "0750"

clickhouse_files_host:
### MAIN CONFIG DIR
  - src: "{{ clickhouse_server_templates_dir }}/{{ clickhouse_main_config_file }}.j2"
    dest: "{{ clickhouse_main_server_config_dir }}/{{ clickhouse_main_config_file }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0440"
  - src: "{{ clickhouse_server_templates_dir }}/{{ clickhouse_users_config_file }}.j2"
    dest: "{{ clickhouse_main_server_config_dir }}/{{ clickhouse_users_config_file }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0440"
  - src: "{{ clickhouse_server_templates_dir }}/{{ clickhouse_dicts_config_file }}.j2"
    dest: "{{ clickhouse_main_server_config_dir }}/{{ clickhouse_dicts_config_file }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0440"
### INCLUDE CONFIG DIR: 'conf.d'
  - src: "{{ clickhouse_server_templates_dir }}/conf.d/{{ clickhouse_remote_servers_config_file }}.j2"
    dest: "{{ clickhouse_include_server_config_dir }}/{{ clickhouse_remote_servers_config_file }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0440"
  - src: "{{ clickhouse_server_templates_dir }}/conf.d/{{ clickhouse_zookeeper_config_file }}.j2"
    dest: "{{ clickhouse_include_server_config_dir }}/{{ clickhouse_zookeeper_config_file }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0440"
  - src: "{{ clickhouse_server_templates_dir }}/conf.d/{{ clickhouse_macros_config_file }}.j2"
    dest: "{{ clickhouse_include_server_config_dir }}/{{ clickhouse_macros_config_file }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0440"
### CLIENT CONFIG DIR
  - src: "{{ clickhouse_client_templates_dir }}/{{ clickhouse_main_client_config_file }}.j2"
    dest: "{{ clickhouse_main_client_config_dir }}/{{ clickhouse_main_client_config_file }}"
    owner: "{{ clickhouse_owner_host['name'] }}"
    group: "{{ clickhouse_group_host['name'] }}"
    mode: "0440"

clickhouse_symlinks:
  - src: "{{ clickhouse_main_data_dir }}"
    dest: "{{ clickhouse_default_main_dir }}"
  - src: "{{ clickhouse_main_server_config_dir }}"
    dest: "{{ clickhouse_default_main_server_config_dir }}"
  - src: "{{ clickhouse_main_client_config_dir }}"
    dest: "{{ clickhouse_default_main_client_config_dir }}"
  - src: "{{ clickhouse_log_dir }}"
    dest: "{{ clickhouse_default_log_dir }}"